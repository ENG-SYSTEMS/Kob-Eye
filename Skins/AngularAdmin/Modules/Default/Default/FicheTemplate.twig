<div class="page-content-inner">
    <ul class="list-unstyled breadcrumb">
        <li>
            <a href="#/TableauDeBord">Tableau de bord</a>
        </li>
        <li>
            <a href="#/{{ CurrentMenu.Url }}">Liste des {{ ObjectClass.getDescription() }}s</a>
        </li>
        <li>
            <a href="javascript: void(0);" ng-bind-html="obj.label"></a>
        </li>
    </ul>

    <!-- Default Panel -->
    <section class="panel">
        <div class="panel-heading">
            <div class="pull-right">
                {% if functions|length > 0 %}
                <div class="btn-group  margin-inline" uib-dropdown>
                    <span id="function-button" type="button" class="btn btn-info  btn-default">Fonctions</span>
                    <button type="button" class="btn btn-info  btn-default" uib-dropdown-toggle>
                        <span class="caret"></span>
                        <span class="sr-only">Split button!</span>
                    </button>
                    <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="function-button">
                        {% for fu in functions %}
                        <li ><a class="dropdown-item" href="javascript: void(0);" ng-click='callFunction(obj,"{{fu.Nom}}","{{fu.title}}")'>{{fu.title}}</a></li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                {% if operation.edit %}<button type="button" class="btn btn-default btn-warning margin-inline" ng-click="modify(obj)">Modifier</button>{% endif %}
                {% if operation.delete %}<button type="button" class="btn btn-default btn-danger margin-inline" ng-click="delete(obj)">Supprimer</button>{% endif %}
            </div>
            <h3 ng-bind-html="obj.label"></h3>
        </div>
        <div class="panel-body">
            <div class="row">
                {% if Interfaces.top %}
                <div class="col-md-12 col-lg-4">
                    <ng-map center="41,-87" zoom="6"></ng-map>
                </div>
                <div class="col-md-12 col-lg-4">
                {% else %}
                <div class="col-md-12 col-lg-6">
                {% endif %}
                    {% for field in fichefields %}
                        <div class="row">
                            <div class="col-md-5 detail-label">
                                <label class="form-control-label" for="l0">{% if field.parentDescription is not empty %}{{ field.parentDescription }}{% else %}{{ field.description }}{% endif %}</label>
                            </div>
                            <div class="col-md-7 detail-value">
                                {% if field.type == "price" %}
                                    <span class="label label-warning">{[{ obj.{{ field.name }} | currency:"" }]} â‚¬</span>
                                {% elseif field.type == "float" %}
                                    <span class="label label-warning">{[{ obj.{{ field.name }}| currency:"" }]}</span>
                                {% elseif field.type == "extlink" %}
                                    <a class="btn btn-success btn-xs" href="https://zabbix.abtel.fr/guacamole/#/client/{[{ obj.{{ field.name }} }]}" target="_blank">{{ field.listDescr }}</a>
                                {% elseif field.type == "int" %}
                                    {% if field.Values %}
                                        <select class="form-control" ng-model="obj.{{ field.name }}" disabled="disabled">
                                            {% for v,k in field.Values %}
                                                <option value="{{ v }}">{{ k }}</option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <span class="label label-primary">{[{ obj.{{ field.name }} }]}</span>
                                    {% endif %}
                                {% elseif field.type == "boolean" %}
                                    <span class="label label-success" ng-if="obj.{{ field.name }}"><i class="fa fa-check"></i></span>
                                    <span class="label label-danger" ng-if="!obj.{{ field.name }}"><i class="fa fa-times"></i></span>
                                {% elseif field.type == "fkey" and field.card == "short" %}
                                    <a class="btn btn-secondary btn-xs" href="#{{ field.link }}/{[{ obj.{{ field.name }} }]}">{[{ obj.{{ field.name }}label }]}</a>
                                {% else %}
                                    {% if field.Values %}
                                        <select class="form-control" ng-model="obj.{{ field.name }}" disabled="disabled">
                                            {% for v,k in field.Values %}
                                                <option value="{{ v }}">{{ k }}</option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <span  ng-bind-html="obj.{{ field.name }}"></span>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% if loop.index - loop.revindex0 == 1 or loop.index - loop.revindex0 == 0 %}
                    </div>
                    {% if Interfaces.top %}
                    <div class="col-md-8 col-lg-4">
                        {% else %}
                    <div class="col-md-8 col-lg-4">
                        {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    <!-- End Default Panel -->
    <div class="nav-tabs-horizontal">
        <ul class="nav nav-tabs" role="tablist">
            {% for child in ChildrenElements %}
            <li class="nav-item">
                <a class="nav-link {% if loop.first %}active{% endif %}" href="javascript: void(0);" data-toggle="tab" data-target="#tab{{ child.objectName }}" role="tab"><b>{{ child.objectDescription }}</b> ({[{ {{ child.objectModule }}{{ child.objectName }}.store.total.children }]})</a>
            </li>
            {% endfor %}
        </ul>
        <div class="tab-content">
            {% for child in ChildrenElements %}
            <div class="tab-pane {% if loop.first %}active{% endif %}" id="tab{{ child.objectName }}" role="tabpanel">
                {% if child.recursive %}
                    {{ include(template_from_string(module(Query~'/Tree'))) }}
                {% else %}
                    <section class="panel">
                        <div class="panel-body">
                            <ng-include src="'/{{ CurrentUrl }}/0/{{ child.objectName }}/ListChildren.htm'" ng-if="show"></ng-include>
                        </div>
                    </section>
                    <!-- End Default Panel -->
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

</div>
{% if Interfaces.bottom %}
        <div class="widget widget-three">
            <iframe style="border:0;" ng-src="{[{ '{{ Interfaces.bottom.Grafana.url }}'+obj.CodeClient+'%20'+obj.Nom }]}" width="100%" height="1100"></iframe>
        </div>
{% endif %}


<div class="modal fade modal-size-large" id="modalfiche-{{ identifier }}" role="modal" aria-labelledby="" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">{[{ modalObj.title }]}</h4>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger" ng-if="modalObj.errors">
                    <ul>
                        <li ng-repeat="e in modalObj.errors">{[{ e.Message }]}</li>
                    </ul>
                </div>
                {{ include(template_from_string(module('Systeme/Utils/Form?Path=[!Query!]'))) }}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary" ng-click="modalSave()">Enregistrer les modifications</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade modal-size-large" id="modalfunction-{{ identifier }}" role="modal" aria-labelledby="" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">{[{ function.title }]}</h4>
            </div>
            <div class="modal-body">
                <div id="ajaxwrapper"
                     ng-show="function.loaded"
                     ng-include="function.url" onload="function.loaded = true">
                </div>

                <div class="text-center"
                     ng-hide="function.loaded">
                    <div id="spinload"></div>
                    <script>
                        new Spinner({color:'#fff', lines: 12}).spin($('#spinload'));
                    </script>
                    Chargement ...
                </div>

                <!--<ng-include src="function.url"></ng-include>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

