app.controller('{{ controller }}Ctrl', function ($location, $scope, $rootScope,$http,AbtelBackupEsxStore) {
    AbtelBackupEsxStore.getData(1,'deploiement');
    $scope.esxs = AbtelBackupEsxStore.data['deploiement'];
    $scope.deployAbtelBackup = function (id,key) {
        console.log('deploy esx',id);
        swal({
                title: "Êtes vous sûr de vouloir déployer AbtelBackup ?",
                text: "Cette opération peut prendre quelques minutes. ",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                cancelButtonText: "Annuler",
                confirmButtonText: "Oui, vas-y !",
                closeOnConfirm: true
            },
            function () {
                $scope.esxs[key].deploy = true;
                $scope.obj = $scope.esxs[key];
                AbtelBackupEsxStore.getOneData(id,'utils',true).then(function (data){
                    $scope.obj = data;
                    $http.get('/AbtelBackup/Esx/'+id+'/deployNow.json')
                    .success(function (data) {

                    });
                });
        });
    }
    $scope.resetData = function () {
        swal({
                title: "Êtes vous sûr de vouloir réinitialiser l'ensemble des données et configurations ?",
                text: "Cette réinitialisation sera définitive. ",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                cancelButtonText: "Annuler",
                confirmButtonText: "Oui, réinitialiser !",
                closeOnConfirm: true
            },
            function () {
                $http.get('/AbtelBackup/Reset.json')
                    .success(function (data) {
                        //redirection à la racine
                        $location.path('/');
                    });
            });
    }
    $scope.initFolders = function () {
        swal({
                title: "Êtes vous sûr de vouloir re-créer l'ensemble des dossiers ?",
                text: "A n'utiliser qu'après modification des volumes. ",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                cancelButtonText: "Annuler",
                confirmButtonText: "Oui !",
                closeOnConfirm: true
            },
            function () {
                $http.get('/AbtelBackup/Init.json')
                    .success(function (data) {
                });
        });
    }
});