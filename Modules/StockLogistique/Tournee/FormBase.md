{"form":{"type":"VBox","id":"StockLogistique/Tournee","label":"Feuille de Route","labelPrefix":"FDR:",
"percentWidth":100,"percentHeight":100,"setStyle":{"paddingTop":0,"paddingLeft":5,"paddingRight":5},
"kobeyeClass":{"module":"StockLogistique","objectClass":"Tournee"},
"localProxy":{
	"actions":{
		"Valide":{"action":"invoke","method":"groupState","params":{"group":"valide","property":"enabled","conditions":[{"dataField":"Valide","value":0},{"hasID":1,"idle":1}]}},
		"proxy_kobeye_status":{"action":[
			{"action":"invoke","method":"groupState","params":{"group":"saved","property":"enabled","hasID":1}},
			{"action":"invoke","method":"groupState","params":{"group":"idle","property":"enabled","idle":1}},
			{"action":"invoke","method":"groupState","params":{"group":"updated","property":"enabled","updated":1}},
			{"action":"invoke","method":"groupState","params":{"group":"savedIdle","property":"enabled","hasID":1,"idle":1}}
			//,{"action":"invoke","method":"groupState","params":{"group":"confirme","property":"enabled","conditions":[{"dataField":"Confirme","value":0},{"hasID":1,"idle":1}]}}
		]},
		"printTournee":{"action":"invoke","method":"callMethod","params":{
			"interface":1,
			"method":"query","data":{"module":"StockLogistique","objectClass":"Tournee","form":"Functions/printTournee.json"},
			"function":"PrintDocuments","args":[{"value":[null]},{"interfaceValues":["Tournee","BL","Fond"]}]}
		},
		"valideTournee":{"action":"invoke","method":"callMethod","params":{
			"interface":1,
			"method":"query","data":{"dirtyChild":1,"module":"StockLogistique","objectClass":"Tournee","form":"Functions/valideTournee.json"},
			"function":"ValideTournee","selectionRequired":1,"args":[{"value":[null]},{"interfaceValues":["Date"]}]}
		}
	}
},
"components":[
	{"type":"MenuTab","id":"menuList","maxLines":1,"menuItems":[
		{"children":[
			{"label":"Sauver","icon":"save","data":"save","stateGroup":"updated"},
			{"label":"Sauver & Fermer","icon":"save","data":"saveClose","stateGroup":"updated"},
			{"label":"Imprimer","icon":"print","data":"printTournee","stateGroup":"savedIdle"},
			{"label":"Valider","icon":"validate","data":"valideTournee","stateGroup":"valide"},
			{"type":"vseparator"},
			{"label":"Direction", "data":"map"}
		]}
	]},
//	{"type":"Box","percentWidth":100,"percentHeight":100,"setStyle":{"paddingTop":0}, 
//	"components":[
		{"type":"EditContainer","id":"edit","percentWidth":100,"percentHeight":100,
		"components":[
			{"type":"VGroup","percentWidth":100,"percentHeight":100,
			"components":[
				{"type":"VGroup","gap":2,"percentWidth":100,"components":[
					{"type":"Group","percentWidth":100,"layout":{"type":"HorizontalLayout","verticalAlign":"baseline","gap":4,"paddingLeft":6,"paddingRight":0,"paddingTop":0,"paddingBottom":2},
					"components":[
						{"type":"Label","text":"Référence"},
						{"type":"TextInput","dataField":"Reference","width":50,"formLabel":1,"editable":0},
						{"type":"Spacer","width":4},
						{"type":"Label","text":"Date"},
						{"type":"DateField","dataField":"Date","defaultValue":"Now"},
						{"type":"Spacer","width":4},
						{"type":"Label","text":"Validé"},
						{"type":"CheckBox","dataField":"Valide","editable":0,"forceEvent":1},
						{"type":"Spacer","width":4},
						{"type":"Label","text":"Effectué"},
						{"type":"CheckBox","dataField":"Effectue"},
						{"type":"Spacer","width":4},
						{"type":"Label","text":"Chauffeur"},
						{"type":"ComboBox","dataField":"ChauffeurId","width":200,"requireSelection":0,
						"kobeyeClass":{"module":"Repertoire","objectClass":"Tiers","identifier":"Id","label":"Intitule","filters":"Livreur=1+Transporteur=1"},
						"actions":[
							{"type":"init","action":"loadData"}
						]},
						{"type":"Spacer","width":4},
						{"type":"Label","text":"Véhicule"},
						{"type":"ComboBox","dataField":"VehiculeId","width":200,"requireSelection":0,
						"kobeyeClass":{"module":"StockLogistique","objectClass":"Vehicule","identifier":"Id","label":"Designation"},
						"actions":[
							{"type":"init","action":"loadData"}
						]}
					]},
					{"type":"Group","percentWidth":100,"layout":{"type":"HorizontalLayout","verticalAlign":"baseline","gap":4,"paddingLeft":6,"paddingRight":0,"paddingTop":0,"paddingBottom":2},
					"components":[
						{"type":"Label","text":"Commentaires"},
						{"type":"TextArea","dataField":"Commentaires","percentWidth":100,"height":40}
					]}
				]},
				{"type":"HGroup","percentWidth":100,"percentHeight":100,"gap":0,
				"components":[
					{"type":"VGroup","width":565,"percentHeight":100,"setStyle":{"paddingLeft":0},
					"components":[
						{"type":"AdvancedDataGrid","dataField":"livraison","id":"livraison","updatedItems":1,
						"width":565,"percentHeight":100,"rowHeight":20,"variableRowHeight":1, 
						"kobeyeClass":{"module":"StockLogistique","objectClass":"Livraison"},"hierarchical":1,
						"events":[
							{"type":"start", "action":"invoke","method":"callMethod",
							"params":{"method":"object","data":{"module":"StockLogistique","objectClass":"Tournee"},
							"function":"GetDeparts"
							//,"args":[{"value":[2,"L"]}]
							}},
							{"type":"dblclick","action":"invoke","objectID":"rightLiv","method":"move"}
						],
						"columns":[
							{"type":"column","dataField":"Reference","headerText":"BL","width":56,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"DateLR","headerText":"Livraison","format":"date","width":54,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Prepare","headerText":"P","format":"boolean","width":20,"setStyle":{"paddingLeft":0,"paddingRight":1}},
							{"type":"column","dataField":"LivraisonId","headerText":"Magasin","width":150,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"CodPostal","headerText":"CP","width":40,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Ville","headerText":"Ville","width":100,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"ClientId","headerText":"Client","width":120,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Famille","headerText":"Famille","width":80,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Quantite","headerText":"Qté","width":30,"format":"int","setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Id","visible":0},
							{"type":"column","width":0}
						]},
						{"type":"AdvancedDataGrid","dataField":"reprise","id":"reprise","updatedItems":1,
						"width":565,"percentHeight":100,"rowHeight":20,"variableRowHeight":1, 
						"kobeyeClass":{"module":"StockLogistique","objectClass":"Reprise"},"hierarchical":1,
						"events":[
							{"type":"start", "action":"invoke","method":"callMethod",
							"params":{"method":"object","data":{"module":"StockLogistique","objectClass":"Tournee"},
							"function":"GetRetours"
							//,"args":[{"value":[3,"R"]}]
							}},
							{"type":"dblclick","action":"invoke","objectID":"rightRep","method":"move"}
						],
						"columns":[
							{"type":"column","dataField":"Reference","headerText":"BR","width":56,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"DateLR","headerText":"Reprise","format":"date","width":54,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"LivraisonId","headerText":"Magasin","width":150,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"CodPostal","headerText":"CP","width":40,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Ville","headerText":"Ville","width":100,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"ClientId","headerText":"Client","width":120,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Famille","headerText":"Famille","width":80,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Quantite","headerText":"Qté","width":30,"format":"int","setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Id","visible":0},
							{"type":"column","width":0}
						]}
					]},
					{"type":"VGroup","width":32,"percentHeight":100,"setStyle":{"paddingLeft":3,"paddingRight":2},
					"components":[
						{"type":"ImageButton","width":30,"height":30,"cornerRadius":15,"id":"up","image":"up"},
						{"type":"ImageButton","width":30,"height":30,"cornerRadius":15,"id":"down","image":"down"},
						{"type":"MoveItemButton","label":">","width":20,"id":"rightLiv","visible":0,"params":{"origineID":"livraison","filtered":1,"destinations":[{"id":"tournee","filter":"Type","value":"L"}]}},
						{"type":"MoveItemButton","label":">","width":20,"id":"rightRep","visible":0,"params":{"origineID":"reprise","filtered":1,"destinations":[{"id":"tournee","filter":"Type","value":"R"}]}},
						{"type":"MoveItemButton","label":"<","width":20,"id":"left","visible":0,"params":{"origineID":"tournee","filtered":1,"destinations":[{"id":"livraison","filter":"Type","value":"L"},{"id":"reprise","filter":"Type","value":"R"}]}}
					]},
					{"type":"VGroup","percentHeight":100,"percentWidth":100,"setStyle":{"paddingRight":0},
					"components":[
						{"type":"AdvancedDataGrid","dataField":"tournee","id":"tournee","updatedItems":0,
						"width":570,"percentHeight":100,"rowHeight":20,"variableRowHeight":1, 
						"kobeyeClass":{"dirtyParent":1,"objectClass":"Lignes"},"hierarchical":1,
						"events":[
							{"type":"start", "action":"invoke","method":"callMethod",
							"params":{"method":"object","data":{"module":"StockLogistique","objectClass":"Tournee"},
							"function":"GetLignes","args":[{"id":["parentForm"]}]}},
							{"type":"dblclick","action":"invoke","objectID":"left","method":"move"},
							{"type":"proxy", "triggers":[
								{"trigger":"up","action":"invoke","method":"itemUp"},
								{"trigger":"down","action":"invoke","method":"itemDown"}
							]}
						],
						"columns":[
							{"type":"column","dataField":"Reference","headerText":"BL/BR","width":56,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Type","headerText":"T","width":16,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"DateLR","headerText":"Date","format":"date","width":54,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Prepare","headerText":"P","format":"boolean","width":20,"setStyle":{"paddingLeft":0,"paddingRight":1}},
							{"type":"column","dataField":"LivraisonId","headerText":"Magasin","width":150,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"CodPostal","headerText":"CP","width":40,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Ville","headerText":"Ville","width":100,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"ClientId","headerText":"Client","width":120,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Famille","headerText":"Famille","width":80,"setStyle":{"paddingLeft":1,"paddingRight":1}},
							//{"type":"column","dataField":"Quantite","headerText":"Qté","width":30,"format":"int","setStyle":{"paddingLeft":1,"paddingRight":1}},
							{"type":"column","dataField":"Id","visible":0},
							{"type":"column","width":0}
						]},
						{"type":"Maps","dataField":"map","percentWidth":100,"percentHeight":100,"key":"Fmjtd%7Cluua256ynu%2Cbl%3Do5-962l5w",
						"from":["","43.865723,4.444256","LOC'ANIM"]}
					]}
				]}
			]}
		],
		"events":[
			{"type":"start","action":"loadValues","params":{"needsParentId":1}},
			{"type":"proxy","triggers":[
				{"trigger":"saveClose","action":"invoke","method":"saveData","params":{"closeForm":1}},
				{"trigger":"save","action":"invoke","method":"saveData"},
				{"trigger":"close","action":"invoke","objectID":"parentForm","method":"closeForm"},
				{"trigger":"cancel","action":"invoke","method":"cancelEdit"},
				{"trigger":"map","action":"invoke","method":"callMethod","params":{
				"method":"object","data":{"module":"StockLogistique","objectClass":"Tournee"},
				"function":"GeoAdresses","args":[{"dataValues":["tournee"]}]}}
			]}
		]}
//	]}
],
"actions":[
	{"type":"close","action":"confirmUpdate"}
]}
}
